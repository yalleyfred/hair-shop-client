<div class="close-button">
  <button color="primary" mat-dialog-close mat-raised-button>
    <mat-icon>close</mat-icon>
  </button>
</div>

<mat-card class="service-form-card">
  <mat-card-header>
    <mat-card-title>{{ dialogData?.id ? 'Update Service' : 'Add Service' }}</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <form (ngSubmit)="onSubmit()" [formGroup]="serviceForm">
      <mat-form-field appearance="fill">
        <mat-label>Service Name</mat-label>
        <input formControlName="name" matInput placeholder="Enter service name" />
        @if (serviceForm.get('name')?.hasError('required')) {
          <mat-error>Service name is required</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Price</mat-label>
        <input formControlName="price" matInput placeholder="Enter price" type="number" />
        @if (serviceForm.get('price')?.hasError('required')) {
          <mat-error>Price is required</mat-error>
        }
        @if (serviceForm.get('price')?.hasError('min')) {
          <mat-error>Price must be at least 0</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Duration (minutes)</mat-label>
        <input formControlName="durationMinutes" matInput placeholder="e.g. 45" type="number" />
        @if (serviceForm.get('durationMinutes')?.hasError('min')) {
          <mat-error>Duration cannot be negative</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Description</mat-label>
        <textarea formControlName="description" matInput placeholder="Enter service description"></textarea>
        @if (serviceForm.get('description')?.hasError('required')) {
          <mat-error>Description is required</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Category</mat-label>
        <mat-select formControlName="categoryId" placeholder="Select a category">
          @for (category of categories; track category.id) {
            <mat-option [value]="category.id">{{ category.name }}</mat-option>
          }
        </mat-select>
        @if (serviceForm.get('categoryId')?.hasError('required')) {
          <mat-error>Category is required</mat-error>
        }
      </mat-form-field>

      <div class="actions">
        <button [disabled]="serviceForm.invalid || isSaving" color="primary" mat-raised-button type="submit">
          {{ isSaving ? 'Saving...' : (dialogData?.id ? 'Update Service' : 'Add Service') }}
        </button>
      </div>

      @if (errorMessage) {
        <p class="error">{{ errorMessage }}</p>
      }
    </form>

  </mat-card-content>
</mat-card>
